/* angular-resource-watcher - v1.2.0 - 2015-11-17 */
"use strict";var rw,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};rw=angular.module("resource.watcher",["ngResource"]).factory("resource",function(a,b){var c,d,e,f,g;return g=function(a){return _.omit(a,function(a,b){return 0===b.indexOf("_")})},c=function(){function a(a){this.previousState=a,this._deleteAddedProperties=__bind(this._deleteAddedProperties,this),this.rollback=__bind(this.rollback,this)}return a.prototype.save=function(a,b,c){return a.executeSave(b,c)},a.prototype.isDirty=function(){return!0},a.prototype.rollback=function(a){return this._deleteAddedProperties(a),a.updateValuesWith(this.previousState),a.setAsPristine()},a.prototype._deleteAddedProperties=function(a){var b,c;return c=function(b){return _.omit(g(a),_.isFunction)},b=_.difference(_.keys(c(a)),_.keys(this.previousState)),b.forEach(function(b){return delete a[b]})},a}(),f=function(){function b(){}return b.prototype.save=function(){return a.when()},b.prototype.isDirty=function(){return!1},b.prototype.rollback=function(){},b}(),d=function(){function a(){this.executeSave=__bind(this.executeSave,this),this.setAsDirty=__bind(this.setAsDirty,this),this.setAsPristine=__bind(this.setAsPristine,this),this.rollback=__bind(this.rollback,this),this.isDirty=__bind(this.isDirty,this),this.save=__bind(this.save,this),this._state=new f}return a.prototype.save=function(a,b){return this._state.save(this,a,b)},a.prototype["delete"]=function(a,b){return a.sendDelete(b)},a.prototype.isNew=function(){return!1},a.prototype.isDirty=function(){return this._state.isDirty()},a.prototype.rollback=function(a){return this._state.rollback(a)},a.prototype.setAsPristine=function(){return this._state=new f},a.prototype.setAsDirty=function(a){return this._state=new c(a)},a.prototype.executeSave=function(a,b){return a.sendPut(b).then(function(a){return function(b){return a.setAsPristine(),b}}(this))},a}(),e=function(b){function d(){this._state=new c}return __extends(d,b),d.prototype["delete"]=function(){return a.when()},d.prototype.isNew=function(){return!0},d.prototype.isDirty=function(){return!0},d.prototype.rollback=function(){throw new Error("can_not_rollback_a_new_resource")},d.prototype.executeSave=function(a,b){return a.sendPost(b).then(function(b){return a.setAsExisting(b.id),b})},d}(d),function(a,c,f){var h,i,j,k,l;return null==c&&(c={}),null==f&&(f={}),l=function(a){return JSON.stringify(g(a))},j={update:{method:"PUT",transformRequest:l},save:{method:"POST",transformRequest:l}},_.assign(j,f),k=_.assign({id:"@id"},c),i=b(a,k,j),h=function(){function a(a){this.sendDelete=__bind(this.sendDelete,this),this.sendPut=__bind(this.sendPut,this),this.sendPost=__bind(this.sendPost,this),this.updateValuesWith=__bind(this.updateValuesWith,this),this.rollback=__bind(this.rollback,this),this.isDirty=__bind(this.isDirty,this),this.setAsPristine=__bind(this.setAsPristine,this),this.setAsDirty=__bind(this.setAsDirty,this),this.isNew=__bind(this.isNew,this),this.setAsExisting=__bind(this.setAsExisting,this),this["delete"]=__bind(this["delete"],this),this.save=__bind(this.save,this),this._state=this._isExisting(a)?new d:new e,this.updateValuesWith(a)}var b;return b=function(b){return new a(b)},a.get=function(a){return i.get(a).$promise.then(b)},a.query=function(a){return i.query(a).$promise.then(function(a){return a.map(b)})},a.prototype._isExisting=function(a){return null!=a?a.id:void 0},a.prototype.save=function(a){return this._state.save(this,a).then(function(){return this})},a.prototype["delete"]=function(a){return this._state["delete"](this,a)},a.prototype.setAsExisting=function(a){return this.id=a,this._state=new d},a.prototype.isNew=function(){return this._state.isNew()},a.prototype.setAsDirty=function(a){return null==a&&(a={}),this._state.setAsDirty(a)},a.prototype.setAsPristine=function(){return this._state.setAsPristine()},a.prototype.isDirty=function(){return this._state.isDirty()},a.prototype.rollback=function(){return this._state.rollback(this)},a.prototype.updateValuesWith=function(a){return _.assign(this,a)},a.prototype.sendPost=function(a){return i.save(a,this).$promise},a.prototype.sendPut=function(a){return i.update(a,this).$promise},a.prototype.sendDelete=function(a){return i["delete"](a,this).$promise},a}()}}),rw.constant("watcherConfig",{save:"Guardar",cancel:"Cancelar"}),rw.directive("watcher",function(a){var b;return b='<div ng-show="isDirty()">\n  <input type="submit" ng-value="saveLabel" class="btn btn-primary"/><a href="" ng-click="cancel()" ng-show="cancelVisible()" class="cancel-link">{{ cancelLabel }}</a>\n</div>',{template:b,restrict:"E",replace:!0,scope:{resource:"=",onCancelWhenNew:"&"},link:function(b,c,d){var e;return e=function(){var a;return a=b.$watch(function(){return b.resource},function(c,d){return c!==d&&c!==d?(b.resource.setAsDirty(d),a()):void 0},!0)},b.saveLabel=a.save,b.cancelLabel=a.cancel,b.cancel=function(){return b.resource.isNew()?b.onCancelWhenNew():(b.resource.rollback(),e())},b.isDirty=function(){return b.resource.isDirty()},b.isNew=function(){return b.resource.isNew()},b.cancelVisible=function(){return!b.isNew()||null!=d.onCancelWhenNew},b.$on("save",function(a,c){return b.resource.save(c).then(e)}),e()}}}).directive("watcherSubmit",function(a){return{restrict:"A",require:"form",scope:!1,link:function(b,c,d,e){return e.attempt=!1,c.bind("submit",function(){return e.attempt=!0,b.$$phase||b.$apply(),e.$valid?b.$broadcast("save",a(d.watcherSubmit)(b)):void 0})}}});